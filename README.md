# tg_bot
Телеграмм бот на Python для ремонтно-строильной компании @RemontStory_bot

Taya, [01.02.2025 23:26]
# tg_bot
Телеграмм бот для ремонтно-строильной компании РЕМОНТСТРОЙ
@RemontStory_bot



Основные кнопки:

- Обработчик кнопки: site @bot.message_handler(команды=\['сайт'\])  
    Эта функция активируется при вводе команды /site. Она отправляет пользователю сообщение: «В ближайшем будущем сайт будет реализован», информируя о том, что функция пока недоступна.
- Обработчик кнопки: start @bot.message_handler(команды=\['запустить'\])  
    Активируется при вводе команды /start. Приветствует пользователя текстом: «Привет! Я помогу вам рассчитать примерную стоимость ремонта квартиры, дома или коммерческой недвижимости». Также отображает основное меню с кнопками «Цены», «Наши работы» и «Рассчитать стоимость ремонта».
- Обработчик кнопок: @bot.callback_query_handler(func=lambda call: True)  
    Обрабатывает нажатия на любые кнопки в боте. Эта функция позволяет идентифицировать выбор пользователя и выполнять соответствующие действия (например, переход к следующему этапу или вызов другой функции).

Расчет площадей:

- Функция для запроса ширины: def get_floor_length(message): Запрашивает у пользователя длину пола. Ответ пользователя записывается для дальнейших расчётов.
- Функция для запроса высоты комнаты :def get_floor_width(message): Запрашивает у пользователя ширину пола. Используется для вычисления площади пола.
- Функция запроса площади окна: пределение get_room_height(message): Запрашивает высоту комнаты. Это значение важно для расчета площади стен.
- Функция сохранения площади окна и вывод площадей пользователю: определение get_window_area(message): Сохраняет площадь окон и рассчитывает площади пола, потолка и стен на основе ранее введённых данных. Выводит результаты пользователю.

Замена введенного неправильного параметра:

- Функция запроса параметра: определение ask_next_step(chat_id):  
    Выводит меню с параметрами, которые пользователь может изменить (длина пола, ширина, высота комнаты, площадь окон).
- Функция замены введенной длины пола: определение update_floor_length(message): Позволяет пользователю ввести новую длину пола. Новое значение сохраняется в базе данных и используется в расчетах.
- Функция замены введенной ширины пола: определение update_floor_width(message): Позволяет изменить ширину пола. После ввода данных они обновляются в базе данных.
- Функция замены введенной высоты комнаты: определение update_room_height(message):  
    Дает возможность изменить высоту комнаты. Новое значение записывается в базу.
- Функция замены введенной площади окна: определение update_window_area(message): Позволяет обновить площадь окон. Эти данные сразу используются для перерасчета.
- Функция перерасчета площадей:

def recalculate_areas (message):  
Выполняет перерасчет всех площадей (пола, потолка, стен) на основе обновленных параметров.

Работа с полом:

- Функция запроса работы по полу: ask_floor_update(chat_id):  
    Спросит пользователя, хочет ли он выполнить работы с полом. Предлагает варианты: «Да», «Нет» или «Пропустить».
- Функция отображения меню выбора работы по полу: def floor_menu(chat_id): Отображает список доступных работ по укладке пола, таких как «Укладка плитки» или «Настил линолеума».

Запись в базу данных:

- Функция записи услуги работы с полом и потолком в базу данных: def save_flour_or_celling_to_db(call, user_id, work_name, type): Сохраняет данные о выбранной работе (по полу или потолку), ее стоимости, площади и общей цене в базе данных.
- Функция записи услуги работы со стенами в базу данных: def save_wall_to_db(call, user_id, work_name):  
    Добавляет данные о работе со стенами в базу данных, включая название услуги, цену, площадь и итоговую стоимость.

Работа с потолком:

- Функция запроса работы по потолку: определение ask_ceiling_update(chat_id): Спрашивает пользователя, хочет ли он выполнить работы с потолком. Пользователь выбирает «Да», «Нет» или «Пропустить».
- Функция отображения меню выбора работы по потолку: меню определения потолка (chat_id): Отображает доступные работы с потолком, например «Устройство натяжного потолка» или «Покраска».

Работа со стенами:

Taya, [01.02.2025 23:26]
- Функция запроса работы по стенам: определение ask_wall_update(chat_id): Спросит пользователя, планирует ли он выполнять работы со стенами. Предоставляет варианты выбора.
- Функция отображения меню выбора работы по стенам: def wall_menu(chat_id): Отображает список работ по отделке стен: поклейка обоев, покраска и другие.

Функция вывода данных в Excel:

def handle_service_skip_wall(вызов): Создает таблицу Excel с данными о выбранных работах (название, площадь, стоимость). Отправляет файл пользователю и выводит общую стоимость всех услуг. Если таблица пуста, уведомляет пользователя о необходимости начать расчет заново.


Инструкция для работы с ботом расчета стоимости ремонта

1\. Запуск бота и начальное меню

1.1 Команда /site

Если клиент введет команду /site, бот отправит сообщение:  
"В ближайшем будущем сайт будет реализован." Это сигнализирует, что разработка сайта находится в процессе.

1.2 Команда /start

Ввод команды /start запускает бота, который поприветствует вас:  
«Привет! Я помогу вам рассчитать приблизительную стоимость ремонта квартиры, дома или коммерческой недвижимости».  
После этого откроется основное меню с тремя кнопками:

- Цены  
    Нажав на эту кнопку, вы перейдете по ссылке на Excel-файл с актуальными расценками на ремонтные работы.
- Наши работы  
    При выборе этой кнопки бот отправит ссылку на Яндекс Диск, где размещены фотографии выполненных компанией работ.
- Рассчитать стоимость ремонта  
    Эта кнопка запускает процесс расчета стоимости ремонта, следуя интерактивным вопросам от бота.

2\. Расчет стоимости ремонта

2.1 Начало расчета

После нажатия кнопки «Рассчитать стоимость ремонта» бот задаст ряд вопросов для определения параметров комнаты:

- "Какая длина пола?"
- "Какая ширина пола?"
- "Какая высота комнаты?"
- "Какая общая площадь окон в комнате?"

2.2 Результат первичного расчет

После ввода всех данных бот рассчитает:

- Площадь пола
- Площадь потолка
- Площадь стен (с учетом площади окон).

Эти данные будут отправлены пользователю в сообщении.

2.3 Меню выбора действия

После вывода расчета появляется меню с кнопками:

- Изменить неверно введенный параметр  
    Выберите параметр, который хотите изменить:
    1. Изменить длину пола
    2. Изменить ширину пола
    3. Изменить высоту комнаты
    4. Изменить площадь окон

После выбора бот попросит ввести новое значение, которое будет записано в базу данных. Расчет обновится автоматически.  
Если клиент случайно нажал эту кнопку, необходимо нажать «Продолжить», чтобы перейти к следующему шагу.

- Продолжить  
    Нажатие этой кнопки записывает введенные данные в базу и переходит к следующему этапу.

3\. Выбор работ

3.1 Работы по полу  

Бот задает вопрос:  
"Вы хотите сделать работы по полу?"

- Если Да, бот предложит варианты:
    1. Настил линолеума
    2. Укладка ламината (по диагонали)
    3. Укладка ламината (по горизонтали)
    4. Укладка плитки

Выбор работы позволяет боту рассчитать стоимость исходя из площади пола и цены за квадратный метр.

- 1. Если вы выбрали _«Пропустить»_, бот перейдет к вопросу о работах с потолком.
- Если нет, бот сразу перейдет к вопросу о работах с потолком.

3.2 Работы по потолку  
Бот задает вопрос:  
"Вы хотите сделать работы по потолку?"

- Если Да, бот предложит варианты:
    1. Устройство подвесных потолков
    2. Устройство натяжного потолка
    3. Покраска потолка

После выбора бот рассчитает стоимость работ с учетом площади потолка и цены за квадратный метр.

- 1. Если вы выбрали «Пропустить», бот перейдет к вопросу о работе со стенами.
- Если Нет, бот сразу перейдет к вопросу о работах со стенами.

3.3 Работы по стенам  
Бот задает вопрос:  
"Вы хотите сделать работы по стенам?"

- Если Да, бот предложит варианты:
    1. Отделка стен тканью
    2. Покраска стен
    3. Поклейка обоев
    4. Укладка плитки/керамогранита на стены

После выбора бот рассчитает стоимость работ с учетом площади стен и цены за квадратный метр.

- 1. Если вы выбрали «Пропустить», бот выведет итоговую стоимость всех выполненных работ.
- Если Нет, бот выведет итоговую стоимость за все выполненные работы.

Taya, [01.02.2025 23:26]
4\. Итоговая информация

4.1 Если работы выбраны

Бот выведет список всех выполненных услуг в формате: номер услуги, наименование услуги, цена за 1 кв.м, площадь и стоимость. Затем бот отправит сообщение с общей суммой всех услуг, например:  
«Общая стоимость всех услуг: 90000,00 ₽». Дополнительно бот отправит Excel-файл с таблицей всех выполненных работ.

4.2 Если работы не выбраны

Бот отправит сообщение: «Нет данных о предоставленных услугах. Пожалуйста, начните расчет заново». Вам нужно будет снова нажать кнопку Рассчитать стоимость ремонта и начать заново.

Пример сценария работы:

1. Вы нажимаете /start, бот приветствует вас.
2. Нажимаете Рассчитать стоимость ремонта и вводите параметры комнаты.
3. Бот рассчитывает площади и выводит данные.
4. Вы выбираете работы по полу и потолку, пропускаете работы по стенам.
5. Бот выводит итоговую стоимость выбранных работ и отправляет Excel-файл.
